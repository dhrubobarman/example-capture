var at=Object.defineProperty;var nt=(n,t,e)=>t in n?at(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>nt(n,typeof t!="symbol"?t+"":t,e);var V='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>',K='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"></path></svg>';var D='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"></path></svg>',Y='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"></path></svg>',U='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"></path></svg>';var g=class{constructor(t,e,o=300,i=!1){r(this,"button");r(this,"container");r(this,"isCollapsed",!1);r(this,"animationDuration",300);r(this,"padding",{top:0,bottom:0});this.button=t,this.container=e,this.animationDuration=o,this.init(),i&&this.collapse()}init(){let t=window.getComputedStyle(this.container);this.padding.top=Math.ceil(parseFloat(t.paddingTop)),this.padding.bottom=Math.ceil(parseFloat(t.paddingBottom)),this.button.innerHTML=U,this.button.addEventListener("click",()=>this.toggleCollapse())}toggleCollapse(){this.isCollapsed?this.expand():this.collapse()}collapse(){this.isCollapsed=!0,this.button.title="Expand",this.container.setAttribute("style",`
      min-height: 0px !important; 
      padding-top: 0px; 
      padding-bottom: 0px; 
      overflow: hidden !important;
      `);let t=this.container.animate([{height:`${this.container.scrollHeight}px`},{height:"0px"}],{duration:this.animationDuration,easing:"ease",fill:"forwards"});t.onfinish=()=>{this.container.setAttribute("data-collapsed",`${this.isCollapsed}`),this.container.classList.remove("expanded"),t.cancel(),this.container.setAttribute("style",`
        height: 0px !important;
        min-height: 0px !important; 
        padding-top: 0px; 
        padding-bottom: 0px; 
        overflow: hidden !important;
        `)},this.button.innerHTML=Y}expand(){this.isCollapsed=!1,this.button.title="Collapse";let t=this.container.clientHeight,e=this.container.scrollHeight+this.padding.top+this.padding.bottom;this.container.style.height=`${t}px`,this.container.style.overflow="hidden",this.container.setAttribute("data-collapsed",`${this.isCollapsed}`),this.container.classList.add("expanded");let o=this.container.animate([{height:`${t}px`},{height:`${e}px`}],{duration:this.animationDuration,easing:"ease",fill:"forwards"});o.onfinish=()=>{o.cancel()},this.button.innerHTML=U,o.onfinish=()=>{o.cancel(),this.container.style.height="auto",this.container.style.overflow="",this.container.style.minHeight="",this.container.style.paddingTop="",this.container.style.paddingBottom=""}}};var w=class{constructor(t,e,o,i=()=>{}){r(this,"container");r(this,"handle");r(this,"isDragging",!1);r(this,"offsetX",0);r(this,"offsetY",0);r(this,"shadowClass","!shadow-2xl");r(this,"name");r(this,"onDragStart");r(this,"onMouseDown",t=>{t.preventDefault(),this.onDragStart(this.container,this.name),this.isDragging=!0,this.offsetX=t.clientX-this.container.offsetLeft,this.offsetY=t.clientY-this.container.offsetTop,this.addElevationStyle()});r(this,"onMouseMove",t=>{this.isDragging&&requestAnimationFrame(()=>{this.container.style.left=`${t.clientX-this.offsetX}px`,this.container.style.top=`${t.clientY-this.offsetY}px`})});r(this,"onMouseUp",()=>{this.isDragging=!1,this.removeElevationStyle()});this.container=t,this.handle=e,this.name=o,this.onDragStart=i,this.handle.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}addElevationStyle(){this.container.style.transition="box-shadow 0.3s ease-in-out",this.container.classList.add("dragging",this.shadowClass),this.handle.classList.add("dragging","!cursor-grabbing")}removeElevationStyle(){this.container.classList.remove("dragging",this.shadowClass),this.handle.classList.remove("dragging","!cursor-grabbing"),this.container.style.transition="box-shadow 0.3s ease-in-out"}};function s(n,t,e=!1){let o=document.createElement(n);return t&&Object.assign(o,t),typeof e=="string"?document.querySelector(e)?.appendChild(o):e===!0?document.querySelector("body")?.appendChild(o):typeof e=="object"&&e.appendChild?.(o),o}var m=s("div",{className:"inspector-capture-container",id:"capture-container"}),f=s("div",{className:"saved-sidebar max-h-[calc(100vh-200px)] shadow-lg card bg-base-300 fixed min-w-[300px] max-w-[300px] min-h-[50px] z-[9999] left-[300px] top-[0px] rounded-md border border-[var(--inspector-border-color,gray)]"},m),x=s("div",{className:"capture-sidebar-header bg-[var(--inpector-card-bg)] rounded-t p-3 flex justify-between items-center border-b border-[var(--inspector-border-color,gray)]"},f);s("span",{className:"capture-sidebar-header-title text-[var(--inpector-sidebar-header-title-color)] text-[20px] font-semibold",innerText:"Saved Steps"},x);var P=s("div",{className:"saved-sidebar"},f),F=s("ul",{className:"capture-sidebar-content overscroll-contain menu bg-base-200 rounded max-h-[calc(100vh-456px)] overflow-y-auto block m-3 min-h-[50px]"},P),X=n=>s("li",{className:"saved-item",innerHTML:`<a><h6 class="text-lg line-clamp-1 ">${n.title}</h6></a>`},F),k=s("div",{className:"capture-sidebar max-h-[calc(100vh-200px)] shadow-lg card bg-base-300 fixed min-w-[300px] max-w-[300px] min-h-[50px] z-[9999] left-0 top-0 rounded-md border border-[var(--inspector-border-color,gray)]"},m),A=s("div",{className:"capture-sidebar-header bg-[var(--inpector-card-bg)] rounded-t p-3 flex justify-between items-center border-b border-[var(--inspector-border-color,gray)]"},k),y=s("div",{className:"card-content p-3"},k),E=(n=A)=>s("button",{className:"btn btn-sm btn-square !cursor-grab border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",innerHTML:V,title:"Click and drag",draggable:!0},n),C=(n=A)=>s("button",{className:"btn btn-sm btn-outline !ml-auto mr-2  btn-square border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",title:"Collapse"},n);s("span",{className:"capture-sidebar-header-title text-[var(--inpector-sidebar-header-title-color)] text-[20px] font-semibold",innerText:"Capture"},A);var Z=s("input",{className:"capture-sidebar-header-title editableInput line-clamp-1 text-center text-[var(--inpector-sidebar-header-title-color)] text-[20px] font-semibold mb-3"},y),G=s("ul",{className:"capture-sidebar-content overscroll-contain menu bg-base-200 rounded max-h-[calc(100vh-456px)] overflow-y-auto block min-h-[50px]"},y),J=(n,t,e=!1)=>s("li",{className:"capture-sidebar-item relative !my-[9px]",innerHTML:`
      <a class="block">
      <h6 class="text-lg line-clamp-1">${n}</h6>
      <p class="text-xs line-clamp-2 text-gray-500">${t}</p>
      <p class="text-center absolute -bottom-[18px] left-0 right-0 flex items-center justify-center z-[2] text-gray-300  step-arrow">${K}</p>
      </a>`},e),M=s("div",{className:"card-actions justify-end mt-4"},y),h=({innerText:n,className:t="btn-neutral",container:e=!1,...o})=>s("button",{className:`btn ${t} btn-sm`,innerText:n,...o},e),b=({elementType:n="input",type:t,placeholder:e,className:o="",container:i=!1,required:a=!1,label:l="",...c})=>{let d=s("label",{className:"form-control w-full",innerHTML:` 
      <div class="label">
        <span class="label-text">${l}${a?"*":""}</span>
      </div>`},i),p=s(n,{className:`inspector-input ${n==="input"?"input input-bordered w-full ":"textarea textarea-bordered w-full "} ${o}`,...n==="input"?{type:t}:{rows:3},placeholder:e,required:a,...c},d);return{inputLabel:d,input:p}},W=h({innerText:"Start New",container:M,className:"btn-success"}),Q=h({innerText:"Save",container:M,className:"mr-auto "}),j=s("dialog",{className:"modal",id:"capture-modal"},m),tt=s("form",{className:"modal-box",id:"capture-dialog-card",onsubmit:n=>n.preventDefault()},j),et=s("div",{className:"capture-dialog-container space-y-4"},tt),rt=s("div",{className:"capture-dialog-container modal-action"},tt);var T={_id:"",title:"",learned:!1,steps:[],url:""},S=class{constructor(t,e,o=()=>{}){r(this,"ui");r(this,"container");r(this,"collapseButton",C());r(this,"sidebarDragHandle",E());r(this,"modal");r(this,"startButton");r(this,"stepData",T);r(this,"modalFooterContainer");r(this,"started",!1);r(this,"modalContentContainer");r(this,"saveButton",Q);r(this,"sidebarUl",G);r(this,"resumeButton",h({innerText:"Resume",type:"button"}));r(this,"listTitle",Z);r(this,"cardActions",M);r(this,"paused",!1);r(this,"name");r(this,"onContainerClick");this.ui=t,this.container=k,this.modal=j,this.startButton=W,this.modalContentContainer=et,this.modalFooterContainer=rt,this.name=e,this.onContainerClick=o,this.init()}init(){new g(this.collapseButton,y),this.initButtons(),this.initInspector(),this.container.onclick=()=>{this.onContainerClick(this.container,this.name)}}initDND(t,e){new w(this.container,this.sidebarDragHandle,t,e)}initInspector(){this.ui.inspector.onElementClick=(t,e)=>{let o=this.ui.inspector.elements.targetElement;m.contains(o)||e.success&&this.openCaptureDialog(e.selector)}}handleOpenEditModal(t){this.openCaptureDialog(t.target,t),this.saveButton.disabled=!1}initButtons(){this.saveButton.disabled=!0,this.resumeButton.disabled=!0,this.startButton.onclick=()=>{this.listTitle.value="",this.resumeButton.disabled=!0,this.saveButton.disabled=!0,this.stepData=T,this.sidebarUl.innerHTML="",this.openNameInputDialog()},this.saveButton.onclick=()=>{this.save()},this.cardActions.appendChild(this.resumeButton),this.resumeButton.onclick=()=>{this.resume()},this.listTitle.oninput=t=>{let e=this.getInputValue(t);this.stepData.title=e;let o=e.length===0||!this.stepData.steps||this.stepData.steps.length===0;this.saveButton.disabled=o}}openNameInputDialog(){this.clearModal();let{input:t,inputLabel:e}=b({placeholder:"Enter Flow Name",type:"text",label:"Flow Name",required:!0});this.stepData.url=window?.location?.href||"",this.stepData._id=`${this.stepData._id||Date.now()}`;let{input:o,inputLabel:i}=b({elementType:"textarea",placeholder:"Enter Flow Description",label:"Flow Description",type:"text"}),{input:a,inputLabel:l}=b({placeholder:"URL where the flow will execute",label:"Flow URL",type:"text",className:"disabled",disabled:!0,required:!0,value:this.stepData.url}),c=h({innerText:"Start",className:"btn-success",type:"submit"}),d=h({innerText:"Cancel",className:"btn-error",type:"button"});c.onclick=()=>{!this.stepData.title||this.stepData.title?.length===0||this.stepData.url?.length===0||(this.started=!0,this.closeModal(),this.startButton.disabled=!0,this.startCapturing())},d.onclick=()=>{this.started=!1,this.closeModal()},t.oninput=p=>{this.stepData.title=this.getInputValue(p),this.listTitle.value=this.stepData.title},o.oninput=p=>{this.stepData.description=this.getInputValue(p)},a.oninput=p=>{this.stepData.url=this.getInputValue(p)},this.modalContentContainer.append(l,e,i),this.modalFooterContainer.append(d,c),this.modal.showModal()}openCaptureDialog(t,e){this.resumeButton.innerText="Resume",this.clearModal(),this.pause();let o={title:e?.title??"",description:e?.description??"",target:t||"",_id:e?._id??`${Date.now()}`},{input:i,inputLabel:a}=b({placeholder:"Enter Step Name",type:"text",label:"Step Name",required:!0,value:e?.title||""}),{input:l,inputLabel:c}=b({elementType:"textarea",placeholder:"Enter Step Description",label:"Step Description",type:"text",value:e?.description||""}),{input:d,inputLabel:p}=b({placeholder:"Step Target",label:"Step Target",type:"text",className:"disabled",disabled:!0,required:!0,value:t||""}),v=h({innerText:"Pause",className:"btn-error mr-auto",type:"button"}),q=h({innerText:"Next",className:"btn-success btn-outline",type:"submit"}),$=h({innerText:"Finish",className:"btn-success",type:"button"}),O=h({innerText:"Re-Capture",className:"btn-error  btn-outline",type:"button"});if(i.oninput=u=>{o.title=this.getInputValue(u)},l.oninput=u=>{o.description=this.getInputValue(u)},d.oninput=u=>{o.target=this.getInputValue(u)},O.onclick=()=>{this.resume(),this.clearModal(),this.closeModal()},q.onclick=()=>{!o.title||o.title?.length===0||(this.stepData.steps=this.stepData.steps||[],this.stepData.steps.push(o),this.resume(),this.clearModal(),this.closeModal(),this.addListItem(o))},v.onclick=()=>{this.pause(),this.resumeButton.disabled=!1},$.onclick=()=>{o.title&&o.title?.length>0&&(this.stepData.steps=this.stepData.steps||[],this.stepData.steps.push(o),this.addListItem(o)),this.pause(),this.startButton.disabled=!1,this.resumeButton.disabled=!1},e){let u=h({innerText:"Update",className:"btn-success",type:"button"}),_=h({innerText:"Cancel",className:"btn-error ml-auto",type:"button"});_.onclick=()=>{this.closeModal(),this.clearModal()},u.onclick=()=>{!o.title||o.title?.length===0||(this.closeModal(),this.clearModal(),this.updateStepContent(o))},this.modalFooterContainer.append(_,u)}else this.stepData.steps&&this.stepData.steps?.length>0&&(this.modalFooterContainer.append($),this.saveButton.disabled=!1),this.modalFooterContainer.append(v),this.modalFooterContainer.append(O,q);this.modalContentContainer.append(p,a,c),this.modal.showModal()}updateStepContent(t){let e=this.stepData.steps?.findIndex(o=>o._id===t._id);e===void 0||e===-1||!this.stepData||!this.stepData.steps||!this.stepData.steps[e]||(this.stepData.steps[e]=t,this.renderStepDataList(this.stepData))}addListItem(t){let e=J(t.title,t.description||"",this.sidebarUl);s("button",{className:"btn btn-sm btn-error btn-outline !text-[var(--error)] btn-square border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",innerHTML:D,title:"Delete Step",onclick:o=>{o.preventDefault(),o.stopPropagation(),this.saveButton.disabled=!1,this.removeItemFromStepData(this.stepData.steps?.findIndex(i=>i._id===t._id),e)}},e),e.onclick=()=>{this.handleOpenEditModal(t)}}renderStepDataList(t){!t||t.steps.length===0||(this.sidebarUl.innerHTML="",this.listTitle.value=t.title,t.steps.forEach(e=>{this.addListItem(e)}),this.stepData=t,this.resumeButton.disabled=!1)}removeItemFromStepData(t,e){t===void 0||t===-1||(this.sidebarUl.removeChild(e),this.stepData.steps?.splice(t,1),this.stepData.steps?.length===0&&(this.saveButton.disabled=!0,this.stepData=T,this.listTitle.value="",this.pause()))}pause(){this.closeModal(),this.clearModal(),this.ui.inspector.pause(),this.paused=!0,this.resumeButton.disabled=!1}resume(){this.resumeButton.disabled=!0,this.paused=!1,this.ui.inspector.resume()}startCapturing(){this.started=!0,this.ui.inspector.startCapturing()}stopCapturing(){this.ui.inspector.stopCapturing(),this.closeModal(),this.clearModal(),this.startButton.disabled=!1}clearModal(){this.modalContentContainer.innerHTML="",this.modalFooterContainer.innerHTML=""}closeModal(){this.modal.close(),this.clearModal()}getInputValue(t){let e=t.target;return e&&e.value||""}async save(){if(this.clearModal(),this.closeModal(),this.stopCapturing(),!this.ui.indexedDb.isDBReady){alert("Database is not ready yet. Please try again later.");return}try{if(!this.stepData._id){alert("Something went wrong. Please try again later.");return}await this.ui.indexedDb.getSingleItem(this.stepData._id)?await this.ui.indexedDb.updateData(this.stepData._id,this.stepData):await this.ui.indexedDb.addData(this.stepData),await this.ui.savedStepUI.fetchData(),console.log(this.stepData),this.stepData=T,this.listTitle.value="",this.sidebarUl.innerHTML="",this.saveButton.disabled=!0,this.resumeButton.disabled=!0}catch(t){console.error(t)}}};var L=class{constructor(t,e,o=()=>{},i=f){r(this,"ui");r(this,"container",f);r(this,"savedSidebarHeader",x);r(this,"savedSidebarUl",F);r(this,"collapseButton",C(x));r(this,"savedSidebarDragHandle",E(x));r(this,"stepData",[]);r(this,"interval");r(this,"retryConnection",0);r(this,"name");r(this,"onContainerClick");this.container=i,this.ui=t,new g(this.collapseButton,P),this.name=e,this.onContainerClick=o,this.init()}async init(){this.container.onclick=()=>{this.onContainerClick(this.container,this.name)};try{this.interval=setInterval(async()=>{if(this.retryConnection>10){alert("Database is not ready yet. Please try again later."),clearInterval(this.interval);return}this.ui.indexedDb.isDBReady?(console.log("DB is ready"),clearInterval(this.interval),await this.fetchData()):(this.retryConnection++,console.log("DB is not ready yet"))},1e3)}catch(t){console.error(t)}}initDND(t,e){new w(this.container,this.savedSidebarDragHandle,t,e)}renderStepData(){this.savedSidebarUl.innerHTML="",this.stepData.forEach(t=>{let e=X(t);e.onclick=()=>{this.ui.captureUI?.renderStepDataList(t)},s("button",{className:"btn btn-sm btn-square btn-error btn-outline !text-[var(--error)] border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",innerHTML:D,title:"Delete Flow",onclick:o=>{o.preventDefault(),o.stopPropagation(),this.deleteStepData(t)}},e),this.savedSidebarUl.appendChild(e)})}async deleteStepData(t){try{await this.ui.indexedDb.deleteData(t._id),await this.fetchData()}catch(e){console.error(e)}}async fetchData(){if(!this.ui.indexedDb.isDBReady){alert("Database is not ready yet. Please try again later.");return}try{let t=await this.ui.indexedDb.getStoreData();return this.stepData=t,this.renderStepData(),t}catch(t){console.error(t)}}};var st=window.location.host,ot=`${st}-step-data`,it="steps";var lt="indexed-db",I=class{constructor({dbName:t=lt,storeName:e,uniqueKey:o,debug:i=!1,version:a=1}){r(this,"isDBReady",!1);r(this,"version");r(this,"dbName");r(this,"storeName");r(this,"key");r(this,"debug");this.version=a,this.isDBReady=!1,this.dbName=t,this.storeName=e,this.key=o,this.debug=i,this.init()}async init(){await this.handleInitDB()}async handleInitDB(){let e=await(async()=>new Promise((o,i)=>{let a=indexedDB.open(this.dbName,this.version);a.onupgradeneeded=()=>{let l=a.result;l.objectStoreNames.contains(this.storeName)||(this.debug&&console.log("Creating users store"),l.createObjectStore(this.storeName,{keyPath:this.key}))},a.onsuccess=()=>{let l=a.result;this.version=l.version,o(l)},a.onerror=()=>{i(a.error)}}))();this.isDBReady=!!e}addData(t){return(async()=>new Promise(o=>{let i=indexedDB.open(this.dbName,this.version);i.onsuccess=()=>{this.debug&&console.log("request.onsuccess - addData",t),i.result.transaction(this.storeName,"readwrite").objectStore(this.storeName).add(t),o(t)},i.onerror=()=>{let a=i.error?.message;o(a||"Unknown error")}}))()}deleteData(t){return(async()=>new Promise(o=>{let i=indexedDB.open(this.dbName,this.version);i.onsuccess=()=>{this.debug&&console.log("request.onsuccess - deleteData",t);let d=i.result.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(t);d.onsuccess=()=>{o(!0)},d.onerror=()=>{o(!1)}}}))()}updateData(t,e){return(async()=>new Promise(i=>{let a=indexedDB.open(this.dbName,this.version);a.onsuccess=()=>{this.debug&&console.log("request.onsuccess - updateData",t);let d=a.result.transaction(this.storeName,"readwrite").objectStore(this.storeName),p=d.get(t);p.onsuccess=()=>{let v={...p.result,...e};d.put(v),i(v)},p.onerror=()=>{i(null)}}}))()}getSingleItem(t){return(async()=>new Promise(o=>{let i=indexedDB.open(this.dbName,this.version);i.onsuccess=()=>{this.debug&&console.log("request.onsuccess - getSingleData");let a=i.result;if(!a)return null;let d=a.transaction(this.storeName,"readonly").objectStore(this.storeName).get(t);d.onsuccess=()=>{o(d.result)}}}))()}getStoreData(){return new Promise(e=>{let o=indexedDB.open(this.dbName,this.version);o.onsuccess=()=>{this.debug&&console.log("request.onsuccess - getAllData");let c=o.result.transaction(this.storeName,"readonly").objectStore(this.storeName).getAll();c.onsuccess=()=>{e(c.result)}}})}};var H=class{constructor(t){r(this,"inspector");r(this,"captureUI");r(this,"savedStepUI");r(this,"indexedDb");this.inspector=t,this.indexedDb=new I({storeName:it,uniqueKey:"_id",dbName:ot,version:4}),this.captureUI=new S(this,"captureUI",this.handleZIndex.bind(this)),this.savedStepUI=new L(this,"savedStepUI",this.handleZIndex.bind(this)),this.initDND()}show(){document.body.appendChild(m)}hide(){try{document.body.removeChild(m)}catch(t){console.log(t)}}initDND(){this.savedStepUI.initDND("savedStepUI",this.handleZIndex.bind(this)),this.captureUI.initDND("captureUI",this.handleZIndex.bind(this))}handleZIndex(t,e){t.style.zIndex="10000",e==="captureUI"?this.savedStepUI.container.style.zIndex="9999":this.captureUI.container.style.zIndex="9999"}};var N=class{constructor(t,e,o){r(this,"inspector");r(this,"hoverElement");r(this,"isHoverElementAddedToDOM");r(this,"targetElement");r(this,"targetElementData");r(this,"highlightColor");r(this,"falseHighlightColor");this.inspector=t,this.isHoverElementAddedToDOM=!1,this.createHoverElement(),this.highlightColor=e,this.falseHighlightColor=o}createHoverElement(){this.hoverElement=this.createElement("div",{className:"inspector-hover-element border-2 border-red-500 fixed z-[1305]"}),this.hoverElement.style.position="fixed",this.hoverElement.style.pointerEvents="none",this.hoverElement.style.zIndex="1305"}addElementToDom(){this.isHoverElementAddedToDOM||(this.isHoverElementAddedToDOM=!0,document.body.appendChild(this.hoverElement))}removeElementFromDom(){this.isHoverElementAddedToDOM&&(this.isHoverElementAddedToDOM=!1,document.body.removeChild(this.hoverElement))}getSelector(t){if(!t)return null;if(t.id)return"#"+t.id;let e=t.parentElement;if(e?.id)return`#${e.id}`;if(t.className){let o=`.${t?.className?.split?.(" ").join(".")}`;return this.escapeTailwindClassNames(o)}}escapeTailwindClassNames(t){return t.replace(/[^a-zA-Z0-9-_.]/g,"\\$&")}getElementData(t){if(!t)return null;let e=t.tagName.toLowerCase(),o=t.getBoundingClientRect(),i=this.getSelector(t),a=Array.from(t.attributes).reduce((l,c)=>(l[c.name]=c.value,l),{});return{tag:e,attributes:a,selector:i,htmlBox:o,element:t,success:!0}}highlightElement(){let t=this.highlightColor,e="blue";if(this.targetElementData){this.targetElementData.success=!0;try{let l=this.getElementDataFromSelector(this.targetElementData.selector);(!l||l?.element!==this.targetElement)&&(t=this.falseHighlightColor,e="red",this.targetElementData.success=!1)}catch(l){console.warn(l),this.targetElementData.success=!1,e="red",t=this.falseHighlightColor}let i=getComputedStyle(this.targetElement).getPropertyValue("border-radius"),{htmlBox:a}=this.targetElementData;this.hoverElement.style.border=`2px dashed ${e}`,this.hoverElement.style.borderRadius=i,this.hoverElement.style.left=a.left+"px",this.hoverElement.style.top=a.top+"px",this.hoverElement.style.width=a.width+"px",this.hoverElement.style.height=a.height+"px",this.hoverElement.style.backgroundColor=t}}getElementDataFromSelector(t){if(!t)return null;let e=document.querySelector(t);return e?this.getElementData(e):null}createElement(t,e){let o=document.createElement(t);return e&&Object.assign(o,e),o}update(){if(!this.targetElement)return;let t=this.getElementData(this.targetElement);t&&(this.targetElementData=t)}render(){this.highlightElement()}};var B=class{constructor(t,e,o=3,i=""){r(this,"inspector");r(this,"countdownInSeconds");r(this,"elements");r(this,"countDown");r(this,"messageContainer");r(this,"counterElement");r(this,"interval");r(this,"timeout");r(this,"isChildPresent",!1);r(this,"messageElement");r(this,"startMessage");this.inspector=t,this.countdownInSeconds=o,this.countDown=o,this.elements=e,this.messageContainer=e.createElement("div"),this.counterElement=e.createElement("h2"),this.messageElement=e.createElement("p",{innerText:"To exit the inspector tool at any time, simply press the Esc key."}),this.startMessage=i,this.init()}init(){this.messageContainer.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.5);
      max-width: 100vw;
      backdrop-filter: blur(10px);
      padding: 50px;
      border-radius: 10px;
      text-align: center;
      color: white;
    `,this.counterElement.style.cssText=`
      font-size: 24px;
      font-weight: bold;
      
    `,this.messageElement.style.cssText=`
      max-width: 300px;
      margin: 15px auto;
      font-size: 18px;
    `;let t=this.elements.createElement("span",{innerText:this.startMessage});this.messageElement.appendChild(t),this.messageContainer.appendChild(this.counterElement),this.messageContainer.appendChild(this.messageElement)}clear(){clearInterval(this.interval),clearTimeout(this.timeout),this.countDown=this.countdownInSeconds,this.isChildPresent&&document.body.removeChild(this.messageContainer)}showCountdown(t){this.counterElement.textContent=this.countDown.toString(),document.body.appendChild(this.messageContainer),this.isChildPresent=!0,this.interval=setInterval(()=>{this.countDown--,this.counterElement.textContent=this.countDown.toString()},1e3),this.timeout=setTimeout(()=>{document.body.removeChild(this.messageContainer),this.isChildPresent=!1,this.countDown=this.countdownInSeconds,t()},this.countdownInSeconds*1e3)}};var z=class{constructor({onElementClick:t,update:e,startMessage:o="",countdownTimeInSeconds:i=3,highlightColor:a="rgba(0,0,255,0.3)",falseHighlightColor:l="rgba(255, 0, 0, 0.3)"}){r(this,"isInspecting");r(this,"boundKeydown");r(this,"boundMousedown");r(this,"boundMouseOver");r(this,"boundContextMenu");r(this,"elements");r(this,"isListenerAttached");r(this,"onElementClick");r(this,"updateFN");r(this,"messages");r(this,"ui");this.isListenerAttached=!1,this.isInspecting=!1,this.elements=new N(this,a,l),this.onElementClick=t,this.updateFN=e,this.messages=new B(this,this.elements,i,o),this.ui=new H(this)}show(){this.ui.show()}hide(){this.ui.hide()}addEventListeners(){this.isListenerAttached||(this.isListenerAttached=!0,this.boundKeydown=this.handleKeydown.bind(this),this.boundMousedown=this.handleMouseDown.bind(this),this.boundMouseOver=this.handleMouseOver.bind(this),this.boundContextMenu=this.handleContextMenu.bind(this),document.addEventListener("keydown",this.boundKeydown),document.addEventListener("mousedown",this.boundMousedown),document.addEventListener("mouseover",this.boundMouseOver),document.addEventListener("contextmenu",this.boundContextMenu))}removeEventListeners(){this.isListenerAttached&&(this.isListenerAttached=!1,document.removeEventListener("keydown",this.boundKeydown),document.removeEventListener("mousedown",this.boundMousedown),document.removeEventListener("mouseover",this.boundMouseOver),document.removeEventListener("contextmenu",this.boundContextMenu))}handleKeydown(t){t.key==="Escape"&&this.stopCapturing(),t.key==="\u1E0D"&&t.altKey&&t.ctrlKey&&(this.isInspecting?this.stopCapturing():this.startCapturing())}handleMouseDown(t){t.preventDefault(),t.stopPropagation(),this.isInspecting&&(t.preventDefault(),t.stopPropagation(),this.onElementClick&&typeof this.onElementClick=="function"&&this.onElementClick(t,this.elements.targetElementData))}handleMouseOver(t){if(!this.isInspecting)return;let e=t.target;this.elements.targetElement=e}handleContextMenu(t){this.isInspecting&&(t.preventDefault(),t.stopPropagation())}pause(){this.stopCapturing()}resume(){this.addEventListeners(),this.isInspecting=!0,this.elements.addElementToDom(),requestAnimationFrame(t=>this.animate(t))}stopCapturing(){this.elements.removeElementFromDom(),this.isInspecting=!1,this.removeEventListeners(),this.messages.clear()}startCapturing(){let t=()=>{this.addEventListeners(),this.isInspecting=!0,this.elements.addElementToDom(),window.requestAnimationFrame(e=>this.animate(e))};this.messages.showCountdown(t)}animate(t){this.isInspecting&&(this.update(t),this.render(),requestAnimationFrame(this.animate.bind(this)))}update(t){this.elements.update(),this.updateFN&&typeof this.updateFN=="function"&&this.updateFN(t)}render(){this.elements.render()}};var R=class{constructor(){r(this,"inspector",new z({}))}start(){this.inspector.show()}stop(){this.inspector.hide()}async getAllData(){try{return await this.inspector?.ui.indexedDb.getStoreData()}catch(t){console.error(t)}}};export{z as Inspector,R as default};
//# sourceMappingURL=main.js.map